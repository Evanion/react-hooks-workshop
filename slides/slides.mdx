export { default as themes } from './themes'
import { Appear } from 'mdx-deck'
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'
import {
  faGithub,
  faTwitter,
  faFacebook,
  faInstagram,
} from '@fortawesome/free-brands-svg-icons'
import {
  faLightbulb,
  faMobileAlt,
  faCubes,
  faFish,
} from '@fortawesome/free-solid-svg-icons'
import { Timeline, TimelineEvent } from './components/Timeline'

<img
  src="https://res.cloudinary.com/smooth/image/upload/v1552399812/logos/smooth-academy.svg"
  alt="Smooth Academy"
  width="30%"
/>

<h1>React Advanced<br />Workshop</h1>

---

<img
  src="https://res.cloudinary.com/smooth/image/upload/w_300,h_300,dpr_2/v1551174170/avatars/greg-berge.jpg"
  alt="Greg Berg√©"
  style={{ width: '50%', maxWidth: 300, borderRadius: '50%' }}
/>

### Greg Berg√©

D√©veloppeur full-stack JavaScript.<br />
Co-fondateur de Smooth Code

<div>
  <a style={{ textDecoration: 'none' }} href="https://github.com/neoziro">
    <FontAwesomeIcon icon={faGithub} /> @neoziro
  </a>
  {' | '}
  <a style={{ textDecoration: 'none' }} href="https://github.com/neoziro">
    <FontAwesomeIcon icon={faTwitter} /> @neoziro
  </a>
</div>

---

# Sommaire

---

# State of React

---

## Historique

<Timeline>
  <Appear>
    <TimelineEvent
      title="Jordan Walke cr√©e React (Reason)"
      createdAt="2010"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faLightbulb} />
      }
    />
    <TimelineEvent
      title="Feed Facebook avec React"
      createdAt="2011"
      iconColor="#3C5A99"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faFacebook} />
      }
    />
    <TimelineEvent
      title="Instagram web en React"
      createdAt="2012"
      iconColor="#E1306C"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faInstagram} />
      }
    />
    <TimelineEvent
      title="React Native Open Source"
      createdAt="2015"
      iconColor="#005068"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faMobileAlt} />
      }
    />
    <TimelineEvent
      title="React Fiber"
      createdAt="2017"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faCubes} />
      }
    />
    <TimelineEvent
      title="React Hooks"
      createdAt="2019"
      icon={<FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faFish} />}
    />
  </Appear>
</Timeline>

---

## React vs Vue vs Angular

<iframe
  style={{ width: '80vw', height: '70vh', overflow: 'hidden' }}
  frameborder="0"
  src="https://npmcharts.com/compare/react,@angular/core,vue?minimal=true&interval=7"
/>

---

## State of Front-end

- React est incontournable
- Vue est en croissance
- Angular est sur le d√©clin

---

# Glossaire

---

## Fiber ?

- R√©√©criture du coeur de React (v16)
- Permet la cr√©ation de nouvelles features
- Hooks, Suspense, Concurrent Mode...

> üëâ Aucun impact pour le d√©veloppeur

---

## Hooks ?

- Nouvelle API de cr√©ation de composants
- Sortie le 6 f√©vrier 2019 (v16.8)

> üëâ Simplification du d√©veloppement

---

## Concurrent Mode ?

- Rendu non bloquant
- Permet d'optimiser les performances
- Mode strict requis
- Sortie √† venir (Q2 2019)

> üëâ Application plus fluide et performante

---

## Suspense ?

- Solution pour g√©rer le data-fetching
- Sortie √† venir (mid 2019)

> üëâ Data-fetching simplifi√©

---

## SSR ?

- Server Side Rendering
- Aussi appel√© "Universal Web App"
- Le HTML est g√©n√©r√©e c√¥t√© serveur
- Inverse de CSR (Client Side Rendering)

> üëâ Le seul use-case est le SEO

---

## Progressive Web App ?

- Application qui fonctionne en offline

> üëâ C'est un must-have, rarement requis

---

# D√©marrer avec React

---

## Create React App

- Moyen le plus rapide pour d√©marrer
- Maintenu par la team React
- SVGR inside ‚ú®üòé

---

## Philosophie

- Zero-config
- Focus sur React
- Scalable (√©jection possible)

---

## Under the hood

- üì¶ Bundler (webpack)
- üåé Dev server (webpack)
- ü§Ø Transpiler (Babel)
- üëÆ‚Äç‚ôÇÔ∏è Linter (ESLint)
- ‚ú® CSS Autoprefixer
- üÉè Test runner (Jest)
- ü¶Å Gestion des SVG (SVGR)

---

# Exercice 1 - create-react-app

---

# React Hooks

---

## Introduction

<iframe
  style={{ width: '80vw', height: '50vh', overflow: 'hidden' }}
  src="https://www.youtube.com/embed/dpw9EHDh2bM"
  frameborder="0"
  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
/>

Pr√©sent√© par Dan Abramov et Sophie Alpert lors de la React Conf 2018.

---

## No breaking change !

- Les classes restent support√©s
- Tout est 100% r√©trocompatible
- Pas impos√©, mais recommand√© üòè

---

## Motivation

- Partage de logique entre composants
- Alternatives aux HOCs et aux render props
- API plus simple √† apr√©hender

---

## Conseils

- Migrer son code progressivement
- Ne pas se forcer √† les utiliser

---

# Qu'est-ce qu‚Äôun Hook ?

---

> Un Hook React est une fonction qui commence par "use" et qui peut √™tre utilis√©e √† l'int√©rieur d'un composant fonctionnel React.

---

# Hooks natifs

---

## Basics

- `useState`
- `useEffect`
- `useContext`

---

## Avanc√©s

- `useReducer`
- `useCallBack`
- `useMemo`
- `useRef`
- `useImperativeHandle`
- `useLayoutEffect`
- `useDebugValue`

---

# `useState`

---

## Example

```js
import React, { useState } from 'react'

function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## Equivalent

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Seulement dans les fonctions !

```js
const Example = props => {
  // You can use Hooks here!
  return <div />
}
```

- Seulement au niveau le plus haut
- Pas de conditions

---

## Fonctions ou constantes ?

```js
const Example = props => {
  // You can use Hooks here!
  return <div />
}
```

```js
function Example(props) {
  // You can use Hooks here!
  return <div />
}
```

> Pr√©f√©rez les fonctions

---

## Le state n‚Äôest pas merg√©

```js
const [coords, setCoords] = useState({ x: 10, y: 20 })
setCoords({ x: 15 }) // the new coords will be { x: 15 } and not { x: 10, y: 15 }
```

---

## D√©clarer plusieurs √©tats

```js
function ExampleWithManyStates() {
  // Declare multiple state variables!
  const [age, setAge] = useState(42)
  const [fruit, setFruit] = useState('banana')
  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }])
  // ...
}
```

> Ne pas h√©siter √† d√©composer les states

---

## √âtat par d√©faut

```js
const [value, setValue] = useState(0) // 0 est la valeur par d√©faut
```

---

## Comment √ßa marche ?

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

- `count` est √† 0 au montage
- Au clic sur le bouton, le state est mis √† jour
- Le composant est re-rendu, `count` est √† 1

---

## Update

```js
const [count, setCount] = useState(0)
// On peut passer une valeur directement
setCount(10)
// Si on utilise le state pr√©c√©dent, on passe une fonction
setCount(previousCount => previousCount + 1)
```

> Toujours utiliser une fonction si on part du state pr√©c√©dent

---

# Controlled VS Uncontrolled

---

## Uncontrolled components

```js
function Example() {
  // Input non contr√¥l√©, il g√®re son state seul
  return <input defaultValue="initial value" />
}
```

---

## Controlled components

```js
function Example() {
  const [value, setValue] = useState('')
  // Input contr√¥l√©, le state est hors du composant "input"
  return (
    <input value={value} onChange={event => setValue(event.target.value)} />
  )
}
```

---

## Controlled to Uncontrolled

```js
function ControlledInput({ defaultValue, ...props }) {
  const [value, setValue] = useState(defaultValue)
  return (
    <input
      value={value}
      onChange={event => setValue(event.target.value)}
      {...props}
    />
  )
}
```

> Il est possible de cr√©er un composant non-contr√¥l√© √† partir d'un composant contr√¥l√©.

---

> Toujours privil√©gier les composants contr√¥l√©s.

---

# Exercice 2 - Create Search Field

---

# `useEffect`

---

# Qu'est-ce qu'un effect ?

---

## Une fonction

## Un effet de bord

## D√©clench√© au rendu du composant

---

## Exemple

```js
import React, { useState, useEffect } from 'react'
function Example() {
  const [count, setCount] = useState(0)

  // Similar to componentDidMount and componentDidUpdate:
  useEffect(() => {
    // Update the document title using the browser API
    document.title = 'You clicked ' + count + ' times'
  })

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## √âquivalent

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  componentDidMount() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  componentDidUpdate() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Penser en effet

- Quel est l‚Äôeffet de bord ?
- Comment dois-je le nettoyer ?
- Qu‚Äôest-ce qui impact cet effet ?

---

## Nettoyage

```js
function ClickSpy() {
  useEffect(() => {
    function handleClick() {
      alert('clicked')
    }
    document.addEventListener('click', handleClick)
    return () => {
      document.removeEventListener('click', handleClick)
    }
  })

  return null
}
```

---

## Lifecycle

- Mount
  - Run effect
- Update
  - Clean effect
  - Run effect
- Unmount
  - Clean effect

---

## Separation of concern

```js
useEffect(() => {
  document.title = 'My title'
})
useEffect(() => {
  pingMyApi()
})
```

> Un effet ‚û° une responsabilit√©

---

## Effect Dependencies

```js
function PageTitle({ title }) {
  useEffect(() => {
    document.title = title
  }, [title]) // this effect will run only if "title" changes
  return null
}
```

> Les d√©pendances permettent d'√©viter de lancer l'effet inutilement

---

## Et seulement au montage ?

```js
function MountSpy() {
  useEffect(() => {
    console.log('Mount')
  }, [])
  return null
}
```

> Pas de d√©pendances, seulement au montage donc !

---

## Lifecycle

- Mount
  - Run effect
- ~~Update~~
  - ~~Clean effect~~
  - ~~Run effect~~
- Unmount
  - Clean effect

---

# Exercice 3 - Fetch Data

---

# Custom Hooks

---

```js
function App() {
  const [query, setQuery] = useState('Lord of the Rings')
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: {
          api_key: 'c5742978852b8f695a61e22a33a8196c',
          query,
        },
      })
      .then(res => {
        setMovies(res.data.results)
      })
  }, [query])

  /* ... */
}
```

---

## Extraire notre Hook

```js
function useMovieSearch(query) {
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: {
          api_key: 'c5742978852b8f695a61e22a33a8196c',
          query,
        },
      })
      .then(res => {
        setMovies(res.data.results)
      })
  }, [query])

  return movies
}
```

---

## Quelques r√®gles

- Tous les hooks doivent √™tre au premier niveau
- Un custom hook est pr√©fix√© par `use`
- Une seule reponsabilit√© par Hook

---

# Exercice 4 - Custom Hooks

---

# Error Boundaries

---

## Utilisation

```js
<ErrorBoundary>
  <MyWidget />
</ErrorBoundary>
```

> Comparable √† un try / catch

---

## Impl√©mentation

```js
import React, { Component } from 'react'

export default class Catch extends Component {
  // Cr√©ation du state initial
  state = { hasError: false }

  static getDerivedStateFromError(error) {
    // Mise √† jour du state, au prochain rendu, nous saurons qu'une erreur a √©t√© catch√©e
    return { hasError: true }
  }

  render() {
    if (this.state.hasError) {
      // Affichage du fallback de notre choix
      return <h1>Something went wrong.</h1>
    }

    return this.props.children
  }
}
```

---

## Conseils

> Mettre des boundaries aux endroits strat√©gique

> Pourquoi pas pour le data-fetching ?

---

# Exercice 5 - Handle errors

---

# Render props

---

## `useCounter`

```js
function useCounter() {
  const [count, setCount] = useState(0)

  useEffect(() => {
    const interval = setInterval(() => setCount(count => count + 1), 1000)
    return () => clearInterval(interval)
  }, [])

  return count
}
```

---

## Utilisation

```js
function Example() {
  const count = useCounter()

  return (
    <div>
      <OtherStuff />
      <div>{count}</div>
    </div>
  )
}
```

---

## Que se passe-t-il ?

- A chaque tick de l'interval, `setCount` est appel√©
- Un nouveau state est g√©n√©r√©
- Le composant `Example` est re-rendu

---

```js
function Example() {
  const count = useCounter()

  return (
    <div>
      {/* OtherStuff va √™tre re-rendu pourtant il n‚Äôutilise pas le compteur */}
      <OtherStuff />
      <div>{count}</div>
    </div>
  )
}
```

---

## Et si `useCounter` √©met une erreur ?

- L‚Äôerreur est √©mise par le composant qui contient le Hook
- `Example` est donc l'√©metteur de l‚Äôerreur

---

# Comment localiser une logique ?

---

## Render props

```js
function Counter({ children }) {
  const count = useCounter()
  return children(count)
}
```

```js
function Example() {
  return (
    <div>
      <OtherStuff />
      <Counter>{count => <div>{count}</div>}</Counter>
    </div>
  )
}
```

---

## Ce qui a chang√©

```js
function Example() {
  return (
    <div>
      {/* Example, ne se re-rend plus, OtherStuff n'est donc pas re-rendu */}
      <OtherStuff />
      {/* Le compteur se re-rend et appelle la fonction "children" */}
      <Counter>{count => <div>{count}</div>}</Counter>
    </div>
  )
}
```

---

## I believe I can catch!

```js
function Example() {
  return (
    <div>
      <OtherStuff />
      {/* Je peux placer une Error Boundary autour de mon composant "Counter" */}
      <Catch>
        <Counter>{count => <div>{count}</div>}</Counter>
      </Catch>
    </div>
  )
}
```

---

## √Ä retenir

> Les hooks ne remplacent pas les render props

> Les render props permettent une isolation du rendu

> Elle permettent une gestion fine des erreurs

---

# Exercice 6 - Render props

---

# Gestion du state avanc√©e

---

## La gestion du state, c‚Äôest dur

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <button onClick={() => setCount(count => count + 1)}>Increment</button>
      <button onClick={() => setCount(count => count - 1)}>Decrement</button>
    </div>
  )
}
```

---

# Comment organiser √ßa ?

---

## `useReducer`

```js
function reducer(count, action) {
  switch (action.type) {
    case 'increment':
      return count + 1
    case 'decrement':
      return count - 1
    default:
      throw new Error('Unsupported action')
  }
}

function Example() {
  const [count, dispatch] = useReducer(reducer)

  return (
    <div>
      <button onClick={() => dispatch({ type: 'increment' })}>Increment</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>Decrement</button>
    </div>
  )
}
```

---

## Avantages

> Gestion du state centralis√©e

> Le reducer est testable

> Le code des composants est plus clair

---

# Exercice 7 - Gestion du state avanc√©e

---

# Cr√©er des composants scalable

---

## Styled Components

<iframe
  src="https://codesandbox.io/embed/2vpm40qk90?autoresize=1&fontsize=14&hidenavigation=1"
  style={{
    width: '80vw',
    height: 500,
    border: 0,
    borderRadius: 4,
    overflow: 'hidden',
  }}
  sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"
/>

---

## Styled Components

- Le style fait parti du composant
- Le style change en fonction des props
- Du vrai CSS !

---

## Comment cr√©er un composant Card ?

---

import Card from './components/Card'

## Ce que je veux obtenir

<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## Je cr√©e mon composant !

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, text }) {
  return (
    <div>
      <CardHeader>{title}</CardHeader>
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

```js
<Card title="Hello!" text="I am Card" />
```

---

# √áa marche !

---

# A new developer is coming!

<iframe
  src="https://giphy.com/embed/Cmr1OMJ2FN0B2"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# Je ne veux pas de titre !

<Card>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## OK, pas de soucis !

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, text }) {
  return (
    <div>
      {title && <CardHeader>{title}</CardHeader>}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

# Another developer is coming!

<iframe
  src="https://giphy.com/embed/3ornk57KwDXf81rjWM"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# Je veux le titre sur un fond vert

<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## OK...

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, titleBackgroundColor, text }) {
  return (
    <div>
      {title && (
        <CardHeader style={{ backgroundColor: titleBackgroundColor }}>
          {title}
        </CardHeader>
      )}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

# A new developer is coming!

<iframe
  src="https://giphy.com/embed/t98sHJAJ69MCoMoXAr"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# Je veux une status bar √† la place du header

<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    My status bar
  </div>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## Euh...

```js
const CardHeader = styled.div``
const CardBody = styled.div``
const StatusBar = styled.div``

function Card({ title, titleBackgroundColor, statusBar, text }) {
  return (
    <div>
      {statusBar && <StatusBar>{statusBar}</StatusBar>}
      {title && (
        <CardHeader style={{ backgroundColor: titleBackgroundColor }}>
          {title}
        </CardHeader>
      )}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

<iframe
  src="https://giphy.com/embed/46itMIe0bkQeY"
  width="480"
  height="267"
  frameBorder="0"
  allowFullScreen
/>

---

# Et si on avait fait autrement ?

---

```js
export const CardHeader = styled.div``
export const CardBody = styled.div``
export const Card = styled.div``
```

```js
<Card>
  <CardHeader>Hello!</CardHeader>
  <CardBody>I am a card</CardBody>
</Card>
```

---

# Les choses auraient √©t√© bien diff√©rentes...

---

## Sans toucher au code

```js
<Card>
  <CardBody>I am a card</CardBody>
</Card>
```

```js
<Card>
  <CardHeader style={{ backgroundColor: 'green' }}>Hello!</CardHeader>
  <CardBody>I am a card</CardBody>
</Card>
```

```js
<Card>
  <CardStatusBar>Hello!</CardStatusBar>
  <CardBody>I am a card</CardBody>
</Card>
```

---

> Utilisez les children et composez vos composants !

---

# Exercice 8 - Composants Scalables

---

# Contexte

---

## A quoi sert le contexte ?

- Faire communiquer deux composants distant

---

## Exemple

```js
import React, { createContext, useContext } from 'react'

// On cr√©e un `ThemeContext` avec pour valeur par d√©faut "white"
const ThemeContext = createContext('white')

function Button({ children }) {
  // On r√©cup√®re la valeur inject√© dans le contexte avec `useContext`
  const theme = useContext(ThemeContext)
  return <button style={{ color: theme }}>{children}</button>
}

function App() {
  // Le `Context.Provider` permet d'injecter une valeur dans `ThemeContext`
  // Tous les enfants ont alors acc√®s √† cette valeur
  return (
    <ThemeContext.Provider value="black">
      <Button>Hello</Button>
    </ThemeContext.Provider>
  )
}
```

---

## Que se passe-t-il ?

- Le `Provider` subit un mount/update
- La valeur inject√©e est-elle diff√©rente ?
  - Oui -> les `Consumer` sont re-rendus
  - Non -> rien ne se passe

---

## Contexte riche

```js
function ThemeProvider({ color, font }) {
  // L'objet `value` est nouveau √† chaque rendu
  // `ThemeContext` notifie donc ses "consumers" √† chaque rendu
  const value = { color, font }
  return (
    <ThemeContext.Provider value={value}>
      <App />
    </ThemeContext.Provider>
  )
}
```

---

## `useMemo`

```js
function ThemeProvider({ theme }) {
  // `useMemo` m√©morise le r√©sultat de la fonction tant que les d√©pendances ne changent pas
  // Tant que `theme` n'a pas chang√©, on aura le m√™me objet `value`
  const value = useMemo(() => ({ theme }), [theme])
  return (
    <ThemeContext.Provider value={value}>
      <App />
    </ThemeContext.Provider>
  )
}
```

---

## Contexte dynamique

```js
function ThemeProvider({ defaultTheme, children }) {
  // Un `state` contient le `theme`
  const [theme, setTheme] = useState(defaultTheme)
  // On injecte la fonction `setTheme` dans le contexte
  const value = useMemo(() => ({ theme, setTheme }), [theme, setTheme])
  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
}

// in another file...

function ThemeSwitcher() {
  const { theme, setTheme } = useContext(ThemeContext)
  return (
    <button
      onClick={() => setTheme(theme => (theme === 'dark' ? 'light' : 'dark'))}
    >
      Switch theme {theme}
    </button>
  )
}
```

---

# Et Redux ?

---

## Qu'est-ce que Redux ?

- Communication entre les composants
- State modifi√© par un reducer
- Connect / Dispatch

---

## Qu'est-ce que Redux ?

- `createContext`
- `useReducer`
- `useContext`

---

```js
// redux.js
import React, { createContext, useReducer, useContext } from 'react'

const ReduxContext = createContext()

export function ReduxProvider({ reducer, initialState, children }) {
  // On cr√© un reducer
  const [state, dispatch] = useReducer(reducer, initialState)
  // On injecte le state et la fonction dispatch
  const value = useMemo(() => ({ state, dispatch }), [state, dispatch])
  return <ReduxContext.Provider value={value}>{children}</ReduxContext.Provider>
}

export function useRedux() {
  return useContext(ReduxContext)
}

// App.js
import React from 'react'
import { ReduxProvider } from './redux'
import { reducer, initialState } from './reducer'

export default function App() {
  return (
    <ReduxProvider reducer={reducer} initialState={initialState}>
      <>
        {/* ... */}
        <RegisterButton />
      </>
    </ReduxProvider>
  )
}

// RegisterButton.js
import React from 'react'
import { useRedux } from './redux'

function RegisterButton() {
  const { dispatch } = useContext(ReduxContext)

  return (
    <button onClick={() => dispatch({ type: 'register' })}>Register</button>
  )
}
```

---

# Exercice 9 - I18N

---

# Interaction avec le DOM

---

## Component Refs

```js
function Example() {
  // `ref.current` sera la r√©f√©rence vers l'√©l√©ment une fois le composant mont√©
  const ref = useRef()
  return <input type="text" ref={ref} />
}
```

---

## Forward Ref

```js
const FancyInput = React.forwardRef((props, ref) => (
  <input ref={ref} className="FancyInput" />
))

function Example() {
  // `ref.current` sera la r√©f√©rence √† l'√©l√©ment DOM button
  const ref = useRef()
  return <FancyInput ref={ref} />
}
```

---

## `useImperativeHandle`

```js
const FancyInput = forwardRef((props, ref) => {
  const inputRef = useRef()

  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus()
    },
  }))

  return <input ref={inputRef} className="FancyInput" />
})

function Example() {
  // `ref.current.focus()` fonctionnera
  const ref = useRef()
  return <FancyInput ref={ref} />
}
```

---

## `useImperativeHandle`

- Permet de customiser l‚Äôinstance g√©n√©r√©e par `useRef`
- A n‚Äôutiliser qu‚Äôavec `forwardRef`

---

# Exercice 10 - Autofocus

---

# `useEffect` en d√©tail

---

## `useEffect` ne marche pas !

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

> useEffect capture les variables au montage

---

## C'√©tait pareil avant

```js
function Example() {
  const [count, setCount] = useState(0)

  function handleAlertClick() {
    setTimeout(() => alert('You clicked on: ' + count), 3000)
  }

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <button onClick={handleAlertClick}>Show alert</button>
    </div>
  )
}
```

[CodeSandbox](https://codesandbox.io/s/w2wxl3yo0l)

---

# Comment faire ?

---

# 1. Sp√©cifier les d√©pendances

---

## Avec d√©pendances

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [count])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

# 2. `useRef` √† la rescousse !

---

## Avec `useRef`

```js
function Example() {
  const [count, setCount] = useState(0)
  const countRef = useRef()
  countRef.current = count
  useEffect(() => {
    const interval = setInterval(() => console.log(countRef.current), 100)
    return () => clearInterval(interval)
  }, [count])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

## Qu'est-ce que le `useRef` ?

- Un objet unique √† votre instance de composant
- Un moyen de stocker des valeurs sans d√©clencher un update

---

## Utilisation

```js
const ref = useRef(/* initial value */)
ref.current // Access ref value using `ref.current`
```

---

# Exercice 11 - Raccourcis clavier

---

# Exercice 12 - Debounce

---
