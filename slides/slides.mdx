import { cloneElement } from 'react'
import { Grid, Row, Col } from '@smooth-ui/core-em'
export { default as theme } from './theme'
import GridLayout from './components/GridLayout'
import Iframe from './components/Iframe'
import Exercise from './components/Exercise'
import Title from './components/Title'
import StepShow from './components/StepShow'
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'
import {
  faGithub,
  faTwitter,
  faFacebook,
  faInstagram,
} from '@fortawesome/free-brands-svg-icons'
import {
  faLightbulb,
  faMobileAlt,
  faCubes,
  faFish,
} from '@fortawesome/free-solid-svg-icons'
import Timeline from './components/Timeline'
import ImageGallery from './images/egghead/ImageGallery.png'
import ManageReactForm from './images/egghead/ManageReactForm.png'
import Mobx from './images/egghead/Mobx.png'
import OptimisticReact from './images/egghead/OptimisticReact.png'
import ReactAdvPatterns from './images/egghead/ReactAdvPatterns.png'
import ReactBeginners from './images/egghead/ReactBeginners.png'
import ReactContext from './images/egghead/ReactContext.png'
import ReactCook from './images/egghead/ReactCook.png'
import ReactDndFinal from './images/egghead/ReactDndFinal.png'
import ReactHooks from './images/egghead/ReactHooks.png'
import ReactMobileNav from './images/egghead/ReactMobileNav.png'
import ReactRecompose from './images/egghead/ReactRecompose.png'
import ReactStart from './images/egghead/ReactStart.png'
import ReactStorybook from './images/egghead/ReactStorybook.png'
import Redux from './images/egghead/Redux.png'
import ReduxStateADT from './images/egghead/ReduxStateADT.png'
import SimplifyHooks from './images/egghead/SimplifyHooks.png'
import TestReactJest from './images/egghead/TestReactJest.png'
import funcExplain from './images/func-explain.jpg'
import contextPic from './images/context.png'

<h1>React Advanced<br />Workshop</h1>

---

<img
  src="https://res.cloudinary.com/smooth/image/upload/w_300,h_300,dpr_2/v1551174170/avatars/greg-berge.jpg"
  alt="Greg Berg√©"
  style={{ width: '50%', maxWidth: 300, borderRadius: '50%' }}
/>

### Greg Berg√©

D√©veloppeur full-stack JavaScript.<br />
Co-fondateur de Smooth Code

<div>
  <a style={{ textDecoration: 'none' }} href="https://github.com/neoziro">
    <FontAwesomeIcon icon={faGithub} /> @neoziro
  </a>
  {' | '}
  <a style={{ textDecoration: 'none' }} href="https://twitter.com/neoziro">
    <FontAwesomeIcon icon={faTwitter} /> @neoziro
  </a>
</div>

---

<img
  src="https://pbs.twimg.com/profile_images/686301436804730881/zCRlzllB_400x400.jpg"
  alt="Olivier Tassinari"
  style={{ width: '50%', maxWidth: 300, borderRadius: '50%' }}
/>

### Olivier Tassinari

Co-creator of Material-UI.

<div>
  <a
    style={{ textDecoration: 'none' }}
    href="https://github.com/oliviertassinari"
  >
    <FontAwesomeIcon icon={faGithub} /> @oliviertassinari
  </a>
  {' | '}
  <a
    style={{ textDecoration: 'none' }}
    href="https://twitter.com/olivtassinari"
  >
    <FontAwesomeIcon icon={faTwitter} /> @olivtassinari
  </a>
</div>

---

## Summary

<Grid fluid>
  <Row>
    <Col>
      <ul>
        <li>State of React</li>
        <li>Terms</li>
        <li>Primitives</li>
        <li>Lifecycle</li>
        <li>Start with React</li>
        <li>Hooks</li>
        <li>Rules of Hooks</li>
        <li>State Management</li>
        <li>Controlled Components</li>
        <li>Effects</li>
      </ul>
    </Col>
    <Col>
      <ul>
        <li>Custom Hooks</li>
        <li>Error Boundaries</li>
        <li>Limit of Boundaries</li>
        <li>Render props</li>
        <li>Advanced State Management</li>
        <li>Scalable Components</li>
        <li>Context</li>
        <li>Avoid Redux</li>
        <li>DOM Interactions</li>
        <li>Effects in depth</li>
      </ul>
    </Col>
  </Row>
</Grid>

---

<Title>
  <Title.Picture src={ReactBeginners} />
  <Title.Text>State of React</Title.Text>
</Title>

---

## History

<Timeline>
  <StepShow
    renderHidden={child => cloneElement(child, { style: { opacity: 0 } })}
  >
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faLightbulb} />
      </Timeline.Icon>
      <Timeline.Date>2010</Timeline.Date>
      <Timeline.Title>Jordan Walke creates React</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faInstagram} />
      </Timeline.Icon>
      <Timeline.Date>2012</Timeline.Date>
      <Timeline.Title>Instagram web in React</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faMobileAlt} />
      </Timeline.Icon>
      <Timeline.Date>2015</Timeline.Date>
      <Timeline.Title>React Native Open Source</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faCubes} />
      </Timeline.Icon>
      <Timeline.Date>2017</Timeline.Date>
      <Timeline.Title>React Fiber</Timeline.Title>
    </Timeline.Event>
    <Timeline.Event>
      <Timeline.Icon>
        <FontAwesomeIcon icon={faFish} />
      </Timeline.Icon>
      <Timeline.Date>2019</Timeline.Date>
      <Timeline.Title>React Hooks, Facebook rewrite in Hooks</Timeline.Title>
    </Timeline.Event>
  </StepShow>
</Timeline>

---

## React vs Vue vs Angular

<Iframe src="https://npmcharts.com/compare/react,@angular/core,vue?minimal=true&interval=7" />

---

## To take away

> üëâ React is the leading solution

> üëâ Vue is growing but not faster than React

> üëâ Angular is still a valid solution

---

<Title>
  <Title.Picture src={ReactStorybook} />
  <Title.Text>Terms</Title.Text>
</Title>

---

## Fiber?

- Rewrote of the internal of React (v16)
- Has allowed the introduction of new features
- Hooks, Suspense, Concurrent Mode...

> üëâ Only internal changes, no breaking changes for you.

---

## Hooks?

- A new API for dynamic logic
- Released 6 February 2019 in v16.8.0

> üëâ A mental model shift

---

## Concurrent Mode?

- Introduce scheduling in the rendering
- Improve the performance
- Require no strict mode warnings
- Should soon be released (Q2 2019)

> üëâ Harder, Better, Faster, Stronger

---

## Suspense?

- Rendering interruptions
- Should soon be released (mid-2019)

> üëâ Simpler Data-fetching

---

## SSR?

- Server-Side Rendering
- Also called "Universal Web App"
- The server returns all the HTML to render the page in the first request
- As opposed to CSR (Client-Side Rendering)

> üëâ Very valuable for SEO and perceived performance

---

## Progressive Web App?

- An application working offline

> üëâ A nice to have

---

<Title>
  <Title.Picture src={ReactCook} />
  <Title.Text>Primitives</Title.Text>
</Title>

---

## JSX

```js
<div className="foo" />
```

> üëâ A syntax extension to JavaScript

---

## Element

```js
const element = <div />
```

> üëâ A React component instance

---

## Component

```jsx
function Div(props) {
  return <div />
}
```

`props => element`

> üëâ Uppercase required!

---

## What's a function?

<img style={{ maxHeight: '80vh', width: '80%' }} src={funcExplain} />

---

export default GridLayout

## Equivalences

```js
// Named function
function fn(props) {
  return props.foo
}
```

```js
// Named function + destructuring
function fn({ foo }) {
  return foo
}
```

```js
// Arrow function
const fn = props => {
  return props.foo
}
```

```js
// Arrow function + destructuring
const fn = ({ foo }) => {
  return foo
}
```

```js
// Short Arrow function + destructuring
const fn = props => props.foo
```

```js
// Short Arrow function + destructuring
const fn = ({ foo }) => foo
```

---

## To take away

> üëâ JSX: A syntax extension to JavaScript

> üëâ Element: A piece of JSX

> üëâ Component: A function that returns an element

---

<Title>
  <Title.Picture src={ImageGallery} />
  <Title.Text>Lifecycle</Title.Text>
</Title>

---

## Phases

- Mount
- Update
- Unmount

---

## Mount

- The React element is inserted in the DOM.

---

## Update

- The element update is reflected in the DOM.
- Trigger by the parent or itself (not the children).

---

## Unmount

- The element is removed from the DOM.

---

## Render vs commit

<Iframe src="https://react-lifecycle.netlify.com" />

---

## To take away

> üëâ Trois phases : Mount, Update, Unmount

> üëâ React first collects the changes in the render step, then commit the changes in a batch.

---

<Title>
  <Title.Picture src={ReactStart} />
  <Title.Text>Start with React</Title.Text>
</Title>

---

## Create React App

- The fastest way to get started
- Maintained by Facebook

---

## Philosophy

- Zero-config
- Focus on React
- No lock-in (can eject)

---

## Under the hood

- üì¶ Bundler (webpack)
- üåé Dev server (webpack)
- ü§Ø Transpiler (Babel)
- üëÆ‚Äç‚ôÇÔ∏è Linter (ESLint)
- ‚ú® CSS Autoprefixer
- üÉè Test runner (Jest)
- ü¶Å Handles SVG (SVGR)
- üöÄ Fine tuned

---

## To take away

> üëâ Projet React ‚Üí create-react-app

---

<Exercise num={1} title="Create React App" />

---

<Title>
  <Title.Picture src={SimplifyHooks} />
  <Title.Text>Hooks</Title.Text>
</Title>

---

## Introduction

<iframe
  style={{ width: '80vw', height: '50vh', overflow: 'hidden' }}
  src="https://www.youtube.com/embed/dpw9EHDh2bM"
  frameborder="0"
  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
/>

Presented by Dan Abramov and Sophie Alpert during the React Conf 2018.

---

## No breaking changes!

- Classes are still supported
- It's 100% backward compatible
- Encouraged for new code

---

## Motivations

- A simpler API to learn
- A paradigm shift
- Surpass the HOCs and render props limitations

---

## To take away

> üëâ You can rewrite your code step by step ü§ó

> üëâ Take your time ü§Ø

---

## What's a Hook üé£ ?

<dl>
  <dt>React Hook</dt>
  <dd>
    <em>/…πiÀêÀà√¶kt/ /h äk/</em> ‚Ä¢ A special function that allows to interact with
    new React features inside a component.
  </dd>
</dl>

---

## Simple hooks üòá

- `useState`
- `useEffect`
- `useContext`

---

## Advanced hooks üòà

- `useReducer`
- `useCallBack`
- `useMemo`
- `useRef`
- `useImperativeHandle`
- `useLayoutEffect`
- `useDebugValue`

---

<Title>
  <Title.Picture src={ReactMobileNav} />
  <Title.Text>Rules of Hooks</Title.Text>
</Title>

---

<h2>Only works in functional components</h2>

```js
function Example(props) {
  // ‚úÖ You can use the hooks here.
  return <div />
}
```

> No Hooks in the classes.

---

<h2>Should always be called in the same order</h2>

```js
function Example(props) {
  if (props.disabled) {
    // üö´ You can't use the hooks here
  }
  return <div />
}
```

> No conditions, unstable loops, etc.

---

<Title>
  <Title.Picture src={ReactRecompose} />
  <Title.Text>State Management</Title.Text>
</Title>

---

## Class Counter

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Hook Counter

```js
import React, { useState } from 'react'

function Example() {
  // "count" is the state, "setCount" is the function to update the state.
  // "0" is the initial value.
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## The state is not merged

```js
const [coords, setCoords] = useState({ x: 10, y: 20 })
setCoords({ x: 15 })
// The new state will be { x: 15 } and not { x: 10, y: 15 }
```

---

## Use different states

```js
function ExampleWithManyStates() {
  // Mutliple states in the same component
  const [age, setAge] = useState(42)
  const [fruit, setFruit] = useState('banana')
  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }])
  // ...
}
```

> üëâ You can call multiple hooks

---

## How does it work?

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

- `count` starts at 0 when it mounts
- When the button is clicked, the state is updated
- The component re-render, `count` is at 1

---

## Update

```js
const [count, setCount] = useState(0)
// You can prodive a new value directly
setCount(10)
// You can pull the previous value
setCount(previousCount => previousCount + 1)
```

> üëâ It's better to use a function when you need to consider the previous value.

---

<Title>
  <Title.Picture src={ManageReactForm} />
  <Title.Text>Controlled Components</Title.Text>
</Title>

---

## Uncontrolled components

```js
function Example() {
  // Uncontrolled component, the input "own" the state.
  return <input defaultValue="initial value" />
}
```

---

## Controlled components

```js
function Example() {
  const [value, setValue] = useState('')
  // Controlled input, the state is "owned" by the component Example.
  return (
    <input value={value} onChange={event => setValue(event.target.value)} />
  )
}
```

---

## Controlled to Uncontrolled

```js
function ControlledInput({ defaultValue, ...props }) {
  const [value, setValue] = useState(defaultValue)
  return (
    <input
      value={value}
      onChange={event => setValue(event.target.value)}
      {...props}
    />
  )
}
```

> üëâ You can create a non-controlled component with a controlled component but not the other way around.

---

## To take away

> üëâ Controlled components are prefered üëÆ‚Äç‚ôÇÔ∏è

---

<Exercise num={2} title="Search Field" />

---

<Title>
  <Title.Picture src={OptimisticReact} />
  <Title.Text>Effects</Title.Text>
</Title>

---

# What's an effect ‚ú®?

---

<dl>
  <dt>Effet</dt>
  <dd>
    <em>\e.f…õ\</em> ‚Ä¢ A side effect function called after the commit phase.
  </dd>
</dl>

---

## Page Title

```js
import React, { useState, useEffect } from 'react'

function Example() {
  const [count, setCount] = useState(0)

  // Close to componentDidMount and componentDidUpdate:
  useEffect(() => {
    // Update the document title using the browser API
    document.title = 'You clicked ' + count + ' times'
  })

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## Classes equivalent

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  componentDidMount() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  componentDidUpdate() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## The "effect" mindset

- What's the effect?
- What should I clean up?
- What trigger this effect?

---

## The clean up

```js
function ClickSpy() {
  useEffect(() => {
    function handleClick() {
      alert('clicked')
    }
    document.addEventListener('click', handleClick)
    // The function return by the effect is the clean up
    return () => {
      document.removeEventListener('click', handleClick)
    }
  })

  return null
}
```

---

## Lifecycle

- Mount
  - Run effect
- Update
  - Clean effect
  - Run effect
- Unmount
  - Clean effect

---

## The separation of the responsibilities

```js
useEffect(() => {
  document.title = 'My title'
})
useEffect(() => {
  pingMyApi()
})
```

> üëâ One effect ‚Üí One problem

---

## Dependencies

```js
function PageTitle({ title }) {
  useEffect(() => {
    document.title = title
  }, [title]) // The effect is triggered for each unique title value
  return null
}
```

> üëâ The dependencies are the external values used in the effect.

---

## Run only once

```js
function MountSpy() {
  useEffect(() => {
    console.log('Mount')
  }, [])
  return null
}
```

> üëâ No dependencies, it's only run during the Mount phase!

---

<Exercise num={3} title="Data Fetching" />

---

<Title>
  <Title.Picture src={ReactHooks} />
  <Title.Text>Custom Hooks</Title.Text>
</Title>

---

## Asynchronous data

```js
function App() {
  const [query, setQuery] = useState('Lord of the Rings')
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    const expired = false
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: { api_key: 'c5742978852b8f695a61e22a33a8196c', query },
      })
      .then(res => {
        if (!expired) {
          setMovies(res.data.results)
        }
      })

    return () => {
      expired = true
    }
  }, [query])

  /* ... */
}
```

> ‚ö†Ô∏è Asynchronous data.

---

## Hooks composition

```js
function App() {
  const [query, setQuery] = useState('Lord of the Rings')
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    const expired = false
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: { api_key: 'c5742978852b8f695a61e22a33a8196c', query },
      })
      .then(res => {
        if (!expired) {
          setMovies(res.data.results)
        }
      })

    return () => {
      expired = true
    }
  }, [query])

  /* ... */
}
```

---

## Let's extract our Hook

```js
function useMovieSearch(query) {
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    const expired = false
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: { api_key: 'c5742978852b8f695a61e22a33a8196c', query },
      })
      .then(res => {
        if (!expired) {
          setMovies(res.data.results)
        }
      })

    return () => {
      expired = true
    }
  }, [query])

  return movies
}
```

```js
function App() {
  const [query, setQuery] = useState('Lord of the Rings')
  useMovieSearch(query)

  /* ... */
}
```

---

## Rules of Hooks

- Predictable order
- A custom hook is prefixed with `use`
- One feature per hook

---

<Exercise num={4} title="Custom Hooks" />

---

<Title>
  <Title.Picture src={ReduxStateADT} />
  <Title.Text>Error Boundaries</Title.Text>
</Title>

---

## Usage

```js
<ErrorBoundary>
  <MyWidget />
</ErrorBoundary>
```

> üëâ Similar to a try/catch

---

## Implementation

```js
import React, { Component } from 'react'

export default class Catch extends Component {
  // We create the initial state
  state = { hasError: false }

  static getDerivedStateFromError(error) {
    // Update the state to display the error message
    return { hasError: true }
  }

  render() {
    if (this.state.hasError) {
      // We display the fallback we like
      return <h1>Something went wrong.</h1>
    }

    return this.props.children
  }
}
```

---

## To take away

> üëâ Use error boundaries at strategical places.

---

<Exercise num={5} title="Error Handling" />

---

<Title>
  <Title.Picture src={ReduxStateADT} />
  <Title.Text>Limits of Boundaries</Title.Text>
</Title>

---

## Let's take this Hook

```js
function useCounter() {
  const [count, setCount] = useState(0)

  useEffect(() => {
    const interval = setInterval(() => setCount(count => count + 1), 1000)
    return () => clearInterval(interval)
  }, [])

  return count
}
```

---

## In a component...

```js
function Example() {
  const count = useCounter()

  return (
    <div>
      <OtherStuff />
      <div>{count}</div>
    </div>
  )
}
```

---

## Que se passe-t-il ?

- At each tick of the interval, `setCount` is called
- A new state value is generated
- The component `Example` rerender

---

## However `OtherStuff` rerenders too!

```js
function Example() {
  const count = useCounter()

  return (
    <div>
      {/* OtherStuff rerender but is not using the counter */}
      <OtherStuff />
      <div>{count}</div>
    </div>
  )
}
```

---

## What if `useCounter` throw an error?

- The error is thrown by the component that hosts the hook
- `Example` is the component that throws the error

---

# How to isolate the logic?

---

<Title>
  <Title.Picture src={ReactAdvPatterns} />
  <Title.Text>Render props</Title.Text>
</Title>

---

## Implementation

```js
function Counter({ children }) {
  const count = useCounter()
  // `children` is usually a node element.
  // Here, it's a function, the "render prop"!
  return children(count)
}
```

---

## Usage

```js
function Example() {
  return (
    <div>
      <OtherStuff />
      {/* We provide the function as a `children` */}
      <Counter>{count => <div>{count}</div>}</Counter>
    </div>
  )
}
```

---

## What changed?

```js
function Example() {
  return (
    <div>
      {/* Example, doesn't rerender, OtherStuff doesn't rerender either */}
      <OtherStuff />
      {/* The compteur rerender, call the "children" function each time */}
      <Counter>{count => <div>{count}</div>}</Counter>
    </div>
  )
}
```

---

## I believe I can catch!

```js
function Example() {
  return (
    <div>
      <OtherStuff />
      {/* I can use an Error Boundary around the component "Counter" */}
      <Catch>
        <Counter>{count => <div>{count}</div>}</Counter>
      </Catch>
    </div>
  )
}
```

---

## To take away

> üëâ The render props still have their use cases (as the HOCs)

> üëâ The render props allow the isolation of the rendering

> üëâ The render props allow a fine grain handling of the errors

---

<Exercise num={6} title="Render props" />

---

<Title>
  <Title.Picture src={ReactRecompose} />
  <Title.Text>Advanced State Management</Title.Text>
</Title>

---

## State handling is hard

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <button onClick={() => setCount(count => count + 1)}>Increment</button>
      <button onClick={() => setCount(count => count - 1)}>Decrement</button>
    </div>
  )
}
```

Can we do better? üôÑ

---

# `useReducer` can help!

<iframe
  src="https://giphy.com/embed/l0HlTPnnfzRsf4f2U"
  width="480"
  height="270"
  frameBorder="0"
  allowFullScreen
/>

---

## The same example with `useReducer`

```js
// The reducer decouple the actions from the output
function reducer(count, action) {
  switch (action.type) {
    case 'increment':
      return count + 1
    case 'decrement':
      return count - 1
    default:
      throw new Error('Unsupported action')
  }
}

function Example() {
  const [count, dispatch] = useReducer(reducer)

  // The component only triggers actions
  return (
    <div>
      <button onClick={() => dispatch({ type: 'increment' })}>Increment</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>Decrement</button>
    </div>
  )
}
```

---

## To take away

> üëâ Decouple the action from the output

> üëâ You can test the reducer logic

---

<Exercise num={7} title="Advanced State" />

---

<Title>
  <Title.Picture src={ReactDndFinal} />
  <Title.Text>Scalable Components</Title.Text>
</Title>

---

## Styled Components

<Iframe src="https://codesandbox.io/embed/2vpm40qk90?autoresize=1&fontsize=14&hidenavigation=1" />

---

## Styled Components

- Collocate the styles with the element
- Accept style functions
- Support the CSS syntax!

---

## How should I create a Card component?

---

import Card from './components/Card'

## What I want:

<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## Ok, let's build it

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, text }) {
  return (
    <div>
      <CardHeader>{title}</CardHeader>
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

```js
<Card title="Hello!" text="I am Card" />
```

---

# It works

---

# A new product owner is coming!

<iframe
  src="https://giphy.com/embed/Cmr1OMJ2FN0B2"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# ‚ÄúCan you remove the title?‚Äù

<Card>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## ‚ÄúOK, no problem!‚Äù

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, text }) {
  return (
    <div>
      {title && <CardHeader>{title}</CardHeader>}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

# A UX designer is coming!

<iframe
  src="https://giphy.com/embed/3ornk57KwDXf81rjWM"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# ‚ÄúThe card title should be on a green background, it's better‚Äù

<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## ‚ÄúOK, I can do it.‚Äù

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, titleBackgroundColor, text }) {
  return (
    <div>
      {title && (
        <CardHeader style={{ backgroundColor: titleBackgroundColor }}>
          {title}
        </CardHeader>
      )}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

<h1>A new marketing manager<br/> appears!</h1>

<iframe
  src="https://giphy.com/embed/t98sHJAJ69MCoMoXAr"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# ‚ÄúCould display a small ad banner instead of the card title?‚Äù

<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    üëª -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## ‚ÄúEuh...‚Äù

```js
const CardHeader = styled.div``
const CardBody = styled.div``
const CardAd = styled.div``

function Card({ title, titleBackgroundColor, ad, text }) {
  return (
    <div>
      {ad && <CardAd>{ad}</CardAd>}
      {title && (
        <CardHeader style={{ backgroundColor: titleBackgroundColor }}>
          {title}
        </CardHeader>
      )}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

<iframe
  src="https://giphy.com/embed/46itMIe0bkQeY"
  width="480"
  height="267"
  frameBorder="0"
  allowFullScreen
/>

---

# Can we do it differently? ü§î

---

```js
export const Card = styled.div``
Card.Body = styled.div``
Card.Header = styled.div``
```

---

# Les choses auraient √©t√© bien diff√©rentes... üòå

---

<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a card</Card.Body>
</Card>

```js
<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

<Card>
  <Card.Body>I am a Card</Card.Body>
</Card>

```js
<Card>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

```js
<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>
```

---

<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    üëª -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a card</Card.Body>
</Card>

```js
<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    üëª -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

## To take away

> üëâ Start as close as the DOM nodes as possible

> üëâ Don't abstract too early

---

<Exercise num={8} title="Scalable Components" />

---

<Title>
  <Title.Picture src={ReactContext} />
  <Title.Text>Context</Title.Text>
</Title>

---

## What's the context?

<img src={contextPic} />

---

## Example

```js
import React, { createContext, useContext } from 'react'

// We create a `ThemeContext` with the default value: "white".
const ThemeContext = createContext('white')

function Button({ children }) {
  // We collect the value present in the context with `useContext`.
  const theme = useContext(ThemeContext)
  return <button style={{ color: theme }}>{children}</button>
}

function App() {
  // The `Context.Provider` component inject a value in `ThemeContext`.
  // All the children have access to it.
  return (
    <ThemeContext.Provider value="black">
      <Button>Hello</Button>
    </ThemeContext.Provider>
  )
}
```

---

## The update mechanism

- The `Provider` is mounted/updated
- Is the injected value different?
  - Yes ‚Üí The `Consumer` are rerender, deep in the React tree
  - No ‚Üí Nothing happens

---

## Rich context values

```js
function ThemeProvider({ color, font }) {
  // We create a new `value` at each render
  // `ThemeContext` everything updates at each render, it's slow
  const value = { color, font }
  return (
    <ThemeContext.Provider value={value}>
      <App />
    </ThemeContext.Provider>
  )
}
```

---

## The solution: `useMemo`

```js
function ThemeProvider({ theme }) {
  // `useMemo` save the output of the function as long as the dependencies are the same.
  // As long as theme does't change, nothing happen.
  const value = useMemo(() => ({ theme }), [theme])
  return (
    <ThemeContext.Provider value={value}>
      <App />
    </ThemeContext.Provider>
  )
}
```

---

## Dynamique context

```js
function ThemeProvider({ defaultTheme, children }) {
  // A `state` holds le `theme`.
  const [theme, setTheme] = useState(defaultTheme)
  // We inject the update function `setTheme` in the context.
  const value = useMemo(() => ({ theme, setTheme }), [theme, setTheme])
  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
}

// in another file...

function ThemeSwitcher() {
  const { theme, setTheme } = useContext(ThemeContext)
  return (
    <button
      onClick={() => setTheme(theme => (theme === 'dark' ? 'light' : 'dark'))}
    >
      Switch theme {theme}
    </button>
  )
}
```

---

<Title>
  <Title.Picture src={Redux} />
  <Title.Text>Should I use Redux?</Title.Text>
</Title>

---

## What's Redux?

- A global data store
- The state changes with a reducer
- Use a connect / dispatch API

---

## It's already in React

- `createContext`
- `useReducer`
- `useContext`

---

```js
// redux.js
import React, { createContext, useReducer, useContext } from 'react'

const ReduxContext = createContext()

export function ReduxProvider({ reducer, initialState, children }) {
  // We create a reducer
  const [state, dispatch] = useReducer(reducer, initialState)
  // We inject the state in the dispatch function
  const value = useMemo(() => ({ state, dispatch }), [state, dispatch])
  return <ReduxContext.Provider value={value}>{children}</ReduxContext.Provider>
}

export function useRedux() {
  return useContext(ReduxContext)
}

// App.js
import React from 'react'
import { ReduxProvider } from './redux'
import { reducer, initialState } from './reducer'

export default function App() {
  return (
    <ReduxProvider reducer={reducer} initialState={initialState}>
      <>
        {/* ... */}
        <RegisterButton />
      </>
    </ReduxProvider>
  )
}

// RegisterButton.js
import React from 'react'
import { useRedux } from './redux'

function RegisterButton() {
  const { dispatch } = useContext(ReduxContext)

  return (
    <button onClick={() => dispatch({ type: 'register' })}>Register</button>
  )
}
```

---

<Exercise num={9} title="Internationalization" />

---

<Title>
  <Title.Picture src={Mobx} />
  <Title.Text>DOM Interactions</Title.Text>
</Title>

---

## Component Refs

```js
function Example() {
  // `ref.current` is a reference toward the DOM element once mounted.
  const ref = useRef()
  return <input type="text" ref={ref} />
}
```

---

## Forward Ref

```js
const FancyInput = React.forwardRef((props, ref) => (
  <input ref={ref} className="FancyInput" />
))

function Example() {
  // `ref.current` will be a reference to te DOM input element.
  const ref = useRef()
  return <FancyInput ref={ref} />
}
```

---

## `useImperativeHandle`

```js
const FancyInput = forwardRef((props, ref) => {
  const inputRef = useRef()

  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus()
    },
  }))

  return <input ref={inputRef} className="FancyInput" />
})

function Example() {
  // `ref.current.focus()` fonctionnera
  const ref = useRef()
  return <FancyInput ref={ref} />
}
```

---

## `useImperativeHandle`

- To affect a custom value to a ref
- To be used with `React.forwardRef`

---

<Exercise num={10} title="Autofocus" />

---

<Title>
  <Title.Picture src={TestReactJest} />
  <Title.Text>Effects in depth</Title.Text>
</Title>

---

## `useEffect` doesn't work!

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

> ‚ö†Ô∏è JavaScript closures

---

## Same as before

<iframe
  src="https://codesandbox.io/embed/w2wxl3yo0l?fontsize=14"
  style={{ width: '100%', height: 500, border: 0, overflow: 'hidden' }}
  sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"
/>

---

# How to solve the problem?

---

# 1. Define the dependencies

---

## With the dependencies

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [count])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

# 2. `useRef`!

---

## With `useRef`

```js
function Example() {
  const [count, setCount] = useState(0)
  const countRef = useRef()
  countRef.current = count
  useEffect(() => {
    const interval = setInterval(() => console.log(countRef.current), 100)
    return () => clearInterval(interval)
  }, [])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

## What's `useRef`?

- A value that is saved during the lifetime of the element
- A way to store values that are not used in the render output

---

## Usage

```js
const ref = useRef(/* initial value */)
ref.current // Access ref value using `ref.current`
```

---

<Exercise num={11} title="Keyboard Shortcuts" />

---

# Thanks!
