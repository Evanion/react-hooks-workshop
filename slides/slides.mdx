export { default as themes } from './themes'

<img
  src="https://res.cloudinary.com/smooth/image/upload/v1552399812/logos/smooth-academy.svg"
  alt="Smooth Academy"
  width="30%"
/>

# React Advanced Workshop

---

import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'
import { faGithub, faTwitter } from '@fortawesome/free-brands-svg-icons'

<img
  src="https://res.cloudinary.com/smooth/image/upload/v1551174170/avatars/greg-berge.jpg"
  alt="Smooth Academy"
  width="20%"
  style={{ borderRadius: '50%' }}
/>

### Greg Berg√©

D√©veloppeur full-stack JavaScript.<br />
Co-fondateur de Smooth Code

<FontAwesomeIcon icon={faGithub} /> <FontAwesomeIcon icon={faTwitter} /> @neoziro

---

# Sommaire

---

# Introduction

---

# State of React

---

## Historique

- 2010 - Jordan Walke cr√©e React (Reason)
- 2011 - React est utilis√© sur le feed Facebook
- 2012 - React est utilis√© sur Instagram
- 2015 - Facebook open source React Native
- 2017 - Facebook annonce React Fiber
- 2018 - Suspense + React Hooks

---

## Downloads

<iframe
  style={{ width: '80vw', height: '70vh', overflow: 'hidden' }}
  frameborder="0"
  src="https://npmcharts.com/compare/react,@angular/core,vue?minimal=true&interval=7"
/>

---

## Evolution

- React est incontournable
- Vue est en croissance
- Angular est sur le d√©clin

---

## Fiber ?

- R√©√©criture du coeur de React (v16)
- Permet la cr√©ation de nouvelles features
- Hooks, Suspense, Concurrent Mode...

---

## Hooks ?

- Nouvelle API de cr√©ation de composants
- Sortie le 6 f√©vrier 2019 (v16.8)

> Simplification du d√©veloppement

---

## Concurrent Mode ?

- Rendu non bloquant
- Permet d'optimiser les performances
- Mode strict requis
- Sortie Q2 2019

> Application plus fluide et performante

---

## Suspense ?

- Solution pour g√©rer le data-fetching
- Sortie mid 2019

> Solution officielle pour g√©rer le data-fetching

---

# D√©marrer avec React

---

## Create React App

- Moyen le plus rapide pour d√©marrer
- Maintenu par la team React
- SVGR inside ‚ú®üòé

---

## Philosophie

- Zero-config
- Focus sur React
- Scalable (√©jection possible)

---

## Under the hood

- üì¶ Bundler (webpack)
- üåé Dev server (webpack)
- ü§Ø Transpiler (Babel)
- üëÆ‚Äç‚ôÇÔ∏è Linter (ESLint)
- ‚ú® CSS Autoprefixer
- üÉè Test runner (Jest)
- ü¶Å Gestion des SVG (SVGR)

---

# Exercice 1 - create-react-app

---

# React Hooks

---

## Introduction

<iframe
  style={{ width: '80vw', height: '50vh', overflow: 'hidden' }}
  src="https://www.youtube.com/embed/dpw9EHDh2bM"
  frameborder="0"
  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
/>

Pr√©sent√© par Dan Abramov et Sophie Alpert lors de la React Conf 2018.

---

## No breaking change !

- Les classes restent support√©s
- Tout est 100% r√©trocompatible
- Pas impos√©, mais recommand√© üòè

---

## Motivation

- Partage de logique entre composants
- Alternatives aux HOCs et aux render props
- API plus simple √† apr√©hender

---

## Conseils

- Migrer son code progressivement
- Ne pas se forcer √† les utiliser

---

# Qu'est-ce qu‚Äôun Hook ?

---

> Un Hook React est une fonction qui commence par "use" et qui peut √™tre utilis√©e √† l'int√©rieur d'un composant fonctionnel React.

---

# Hooks natifs

---

## Basics

- `useState`
- `useEffect`
- `useContext`

---

## Avanc√©s

- `useReducer`
- `useCallBack`
- `useMemo`
- `useRef`
- `useImperativeHandle`
- `useLayoutEffect`
- `useDebugValue`

---

# `useState`

---

## Example

```js
import React, { useState } from 'react'

function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## Equivalent

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Seulement dans les fonctions !

```js
const Example = props => {
  // You can use Hooks here!
  return <div />
}
```

- Seulement au niveau le plus haut
- Pas de conditions

---

## Fonctions ou constantes ?

```js
const Example = props => {
  // You can use Hooks here!
  return <div />
}
```

```js
function Example(props) {
  // You can use Hooks here!
  return <div />
}
```

> Pr√©f√©rez les fonctions

---

## Le state n‚Äôest pas merg√©

```js
const [coords, setCoords] = useState({ x: 10, y: 20 })
setCoords({ x: 15 }) // the new coords will be { x: 15 } and not { x: 10, y: 15 }
```

---

## D√©clarer plusieurs √©tats

```js
function ExampleWithManyStates() {
  // Declare multiple state variables!
  const [age, setAge] = useState(42)
  const [fruit, setFruit] = useState('banana')
  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }])
  // ...
}
```

> Ne pas h√©siter √† d√©composer les states

---

## √âtat par d√©faut

```js
const [value, setValue] = useState(0) // 0 est la valeur par d√©faut
```

---

## Comment √ßa marche ?

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

- `count` est √† 0 au montage
- Au clic sur le bouton, le state est mis √† jour
- Le composant est re-rendu, `count` est √† 1

---

## Update

```js
const [count, setCount] = useState(0)
// On peut passer une valeur directement
setCount(10)
// Si on utilise le state pr√©c√©dent, on passe une fonction
setCount(previousCount => previousCount + 1)
```

> Toujours utiliser une fonction si on part du state pr√©c√©dent

---

# Controlled VS Uncontrolled

---

## Uncontrolled components

```js
function Example() {
  // Input non contr√¥l√©, il g√®re son state seul
  return <input defaultValue="initial value" />
}
```

---

## Controlled components

```js
function Example() {
  const [value, setValue] = useState('')
  // Input contr√¥l√©, le state est hors du composant "input"
  return (
    <input value={value} onChange={event => setValue(event.target.value)} />
  )
}
```

---

## Controlled to Uncontrolled

```js
function ControlledInput({ defaultValue, ...props }) {
  const [value, setValue] = useState(defaultValue)
  return (
    <input
      value={value}
      onChange={event => setValue(event.target.value)}
      {...props}
    />
  )
}
```

> Il est possible de cr√©er un composant non-contr√¥l√© √† partir d'un composant contr√¥l√©.

---

> Toujours privil√©gier les composants contr√¥l√©s.

---

# Exercice 2 - Create Search Field

---

# `useEffect`

---

# Qu'est-ce qu'un effect ?

---

## Une fonction

## Un effet de bord

## D√©clench√© au rendu du composant

---

## Exemple

```js
import React, { useState, useEffect } from 'react'
function Example() {
  const [count, setCount] = useState(0)

  // Similar to componentDidMount and componentDidUpdate:
  useEffect(() => {
    // Update the document title using the browser API
    document.title = 'You clicked ' + count + ' times'
  })

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## √âquivalent

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  componentDidMount() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  componentDidUpdate() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Penser en effet

- Quel est l‚Äôeffet de bord ?
- Comment dois-je le nettoyer ?
- Qu‚Äôest-ce qui impact cet effet ?

---

## Nettoyage

```js
function ClickSpy() {
  useEffect(() => {
    function handleClick() {
      alert('clicked')
    }
    document.addEventListener('click', handleClick)
    return () => {
      document.removeEventListener('click', handleClick)
    }
  })

  return null
}
```

---

## Lifecycle

- Mount
  - Run effect
- Update
  - Clean effect
  - Run effect
- Unmount
  - Clean effect

---

## Separation of concern

```js
useEffect(() => {
  document.title = 'My title'
})
useEffect(() => {
  pingMyApi()
})
```

> Un effet ‚û° une responsabilit√©

---

## Effect Dependencies

```js
function PageTitle({ title }) {
  useEffect(() => {
    document.title = title
  }, [title]) // this effect will run only if "title" changes
  return null
}
```

> Les d√©pendances permettent d'√©viter de lancer l'effet inutilement

---

## Et seulement au montage ?

```js
function MountSpy() {
  useEffect(() => {
    console.log('Mount')
  }, [])
  return null
}
```

> Pas de d√©pendances, seulement au montage donc !

---

## Lifecycle

- Mount
  - Run effect
- ~~Update~~
  - ~~Clean effect~~
  - ~~Run effect~~
- Unmount
  - Clean effect

---

# Exercice 3 - Fetch Data

---

# Error Boundaries

---

## Utilisation

```js
<ErrorBoundary>
  <MyWidget />
</ErrorBoundary>
```

> Comparable √† un try / catch

---

## Exemple

```js
class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props)
    this.state = { hasError: false }
  }

  static getDerivedStateFromError(error) {
    // Update state so the next render will show the fallback UI.
    return { hasError: true }
  }

  componentDidCatch(error, info) {
    // You can also log the error to an error reporting service
    logErrorToMyService(error, info)
  }

  render() {
    if (this.state.hasError) {
      // You can render any custom fallback UI
      return <h1>Something went wrong.</h1>
    }

    return this.props.children
  }
}
```

---

## Conseils

> Mettre des boundaries aux endroits strat√©gique

> Pourquoi pas pour le data-fetching ?

---

# Exercice 4 - Handle errors

---

# Gestion du state avanc√©e

---

## La gestion du state, c‚Äôest dur

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <button onClick={() => setCount(count => count + 1)}>Increment</button>
      <button onClick={() => setCount(count => count - 1)}>Decrement</button>
    </div>
  )
}
```

---

# Comment organiser √ßa ?

---

## `useReducer`

```js
function reducer(count, action) {
  switch (action.type) {
    case 'increment':
      return count + 1
    case 'decrement':
      return count - 1
    default:
      throw new Error('Unsupported action')
  }
}

function Example() {
  const [count, dispatch] = useReducer(reducer)

  return (
    <div>
      <button onClick={() => dispatch({ type: 'increment' })}>Increment</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>Decrement</button>
    </div>
  )
}
```

---

## Avantages

> Gestion du state centralis√©e

> Le reducer est testable

> Le code des composants est plus clair

---

# Exercice 5 - Loading

---

# Cr√©er des composants scalable

---

# Exercice 6 - Card component

---

# Exercice 7 - Internationalisation

---

# Exercice 8 - Raccourcis clavier

---

# Exercice 9 - Debounce

---

## `useEffect` doesn't work

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

> useEffect capture les variables au montage

---

## C'√©tait pareil avant

```js
function Example() {
  const [count, setCount] = useState(0)

  function handleAlertClick() {
    setTimeout(() => alert('You clicked on: ' + count), 3000)
  }

  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Click me</button>
      <button onClick={handleAlertClick}>Show alert</button>
    </div>
  )
}
```

[CodeSandbox](https://codesandbox.io/s/w2wxl3yo0l)

---

# Comment faire ?

---

# 1. Sp√©cifier les d√©pendances

---

## Avec d√©pendances

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [count])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

# 2. `useRef` √† la rescousse !

---

## Avec `useRef`

```js
function Example() {
  const [count, setCount] = useState(0)
  const countRef = useRef()
  countRef.current = count
  useEffect(() => {
    const interval = setInterval(() => console.log(countRef.current), 100)
    return () => clearInterval(interval)
  }, [count])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

## Qu'est-ce que le `useRef` ?

- Un objet unique √† votre instance de composant
- Un moyen de stocker des valeurs sans d√©clencher un update

---

## Utilisation

```js
const ref = useRef(/* initial value */)
ref.current // Access ref value using `ref.current`
```

---

# Et la propri√©t√© `ref` ?

---

## M√™me principe !

```js
function Example() {
  const divRef = useRef()
  // After mount, `divRef.current` will contain the DOM Element
  return <div ref={divRef} />
}
```

---
